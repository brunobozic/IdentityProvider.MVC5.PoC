
@model IdentityProvider.Models.ViewModels.Operations.OperationAuditTrailPagedVm

@using IdentityProvider.UI.Web.MVC5.Extensions
@using PagedList.Mvc

@{
    string currentFilter = ViewBag.OpAudTrailCurrentFilter;
    string currentSort = ViewBag.OpAudTrailCurrentSort;

    if (string.IsNullOrEmpty(currentSort))
    {
        currentSort = "UpdatedAt_Desc";
    }
}

<div class="container-fluid">
    <div class="row">
        <div class="card">
            <div class="body container-fluid">
                @using (Html.BeginForm("OperationAuditTrailGetAllPaged" , "Operation" , FormMethod.Get , new { id = "auditTrailSearchAndPageSizeForm" }))
                {
                    <div class="col-xs-10">
                        <div class="form-line" style="margin-left: 5px">
                            @Html.TextBox("SearchString" , ViewBag.OpAudTrailCurrentFilter as string , new { @placeholder = "Search" , @value = ViewBag.OpAudTrailCurrentFilter , @data_toggle = "tooltip" , @data_placement = "top" , @title = "" , @data_original_title = "Enter search criteria" })
                            @Html.ValidationMessage("Search")
                            <button class="btn bg-purple waves-effect btn-xs" id="submitSearch" style="margin: 1px; margin-bottom: 4px" type="submit" name="submitSearch" data-toggle="tooltip" data-placement="right" title="" data-original-title="Begin search"><i class="material-icons">search</i></button>
                        </div>
                    </div>

                    <div class="col-xs-2">
                        <div class="form-line" style="float: right; margin-right: 8px">
                            @Html.DropDownListFor(m => m.PageSize , Model.PageSizeList , new { id = "PageSizeList" , @class = "js-select2-enabled" , @style = "padding: 5px; width: 55px" })
                        </div>
                    </div>

                    <div class="body" style="width: 100% !important">

                        <table class="table table-striped table-light table-condensed my-fixed-layout-table" Id="operationsGrid">
                            <thead>
                                <tr>
                                    <th style="">
                                        <span data-toggle="tooltip" data-placement="auto top" title="" data-original-title="Sort by table name">
                                            @Html.ActionLink("TableName" , "OperationAuditTrailGetAllPaged" , Request.QueryString.ToRouteValueDictionary("sortOrder" , ( string ) ViewBag.OpAudTrailTableNameSortParam))
                                            @Html.SortIdentifier(currentSort , "TableName")
                                        </span>
                                    </th>
                                    <th style="">
                                        <span data-toggle="tooltip" data-placement="auto top" title="" data-original-title="Sort by user name">
                                            @Html.ActionLink("UserName" , "OperationAuditTrailGetAllPaged" , Request.QueryString.ToRouteValueDictionary("sortOrder" , ( string ) ViewBag.OpAudTrailUserNameSortParam))
                                            @Html.SortIdentifier(currentSort , "UserName")
                                        </span>
                                    </th>
                                    <th style="width:50px">
                                        <span style="text-align: left;" data-toggle="tooltip" data-placement="top" title="" data-original-title="Sort by old data">
                                            @Html.ActionLink("OldData" , "OperationAuditTrailGetAllPaged" , Request.QueryString.ToRouteValueDictionary("sortOrder" , ( string ) ViewBag.OpAudTrailOldDataSortParam))
                                            @Html.SortIdentifier(currentSort , "OldData")
                                        </span>
                                    </th>
                                    <th style="width:148px">
                                        <span style="text-align: left" data-toggle="tooltip" data-placement="top" title="" data-original-title="Sort by new data">
                                            @Html.ActionLink("NewData" , "OperationAuditTrailGetAllPaged" , Request.QueryString.ToRouteValueDictionary("sortOrder" , ( string ) ViewBag.OpAudTrailNewDataSortParam))
                                            @Html.SortIdentifier(currentSort , "NewData")
                                        </span>
                                    </th>
                                    <th style="width:148px">
                                        <span style="text-align: left" data-toggle="tooltip" data-placement="top" title="" data-original-title="Sort by table id">
                                            @Html.ActionLink("TableId" , "OperationAuditTrailGetAllPaged" , Request.QueryString.ToRouteValueDictionary("sortOrder" , ( string ) ViewBag.OpAudTrailTableIdSortParam))
                                            @Html.SortIdentifier(currentSort , "TableId")
                                        </span>
                                    </th>
                                    <th style="width:148px">
                                        <span style="text-align: left" data-toggle="tooltip" data-placement="top" title="" data-original-title="Sort by updated at">
                                            @Html.ActionLink("UpdatedAt" , "OperationAuditTrailGetAllPaged" , Request.QueryString.ToRouteValueDictionary("sortOrder" , ( string ) ViewBag.OpAudTrailUpdatedAtSortParam))
                                            @Html.SortIdentifier(currentSort , "UpdatedAt")
                                        </span>
                                    </th>
                                    <th style="width:148px">
                                        <span style="text-align: left" data-toggle="tooltip" data-placement="top" title="" data-original-title="Sort by action">
                                            @Html.ActionLink("Action" , "OperationAuditTrailGetAllPaged" , Request.QueryString.ToRouteValueDictionary("sortOrder" , ( string ) ViewBag.OpAudTrailActionSortParam))
                                            @Html.SortIdentifier(currentSort , "Action")
                                        </span>
                                    </th>
                                </tr>
                            </thead>

                            @Html.Partial("Partial/_operationAuditTrailPartial" , Model)

                        </table>
                    </div>
                }
            </div>
            <div class="footer">
                @if (Model.OperationAuditTrail.PageCount > 1)
                {
                    <div class="pager">
                        @Html.PagedListPager(Model.OperationAuditTrail , page => Url.Action("OperationAuditTrailGetAllPaged" , new
                        {
                            page ,
                            sortOrder = Model.SortOrder,
                            currentFilter = Model.SearchString,
                            pageNumber = page ,
                            pageSize = Model.PageSize,
                        }))
                        Page @(Model.OperationAuditTrail.PageCount < Model.OperationAuditTrail.PageNumber ? 0 : Model.OperationAuditTrail.PageNumber) of @Model.OperationAuditTrail.PageCount
                    </div>
                }
                else
                {
                    <div><hr /></div>
                }
            </div>
        </div>
    </div>
</div>